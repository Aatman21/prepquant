<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Question Â· PrepQuant</title>

  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css"/>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
</head>
<body>

<header class="hero" style="padding:28px 20px;text-align:center">
  <div class="hero__copy" style="max-width:760px">
    <h1 style="font-size:2rem;color:#111;margin-bottom:6px">Question</h1>
    <p class="section-sub" style="margin-top:0">Think first. Then peek at hints. Own the solution.</p>
  </div>
</header>

<main class="container fade" id="box" style="max-width:760px;margin-top:32px">
  <p>Loadingâ€¦</p>
</main>

<footer class="container footer">
  <div>Youâ€™re doing great. One problem at a time. ðŸ’ª</div>
</footer>

<script>
const LS=(k,d)=>JSON.parse(localStorage.getItem(k)||JSON.stringify(d));
const S =(k,v)=>localStorage.setItem(k,JSON.stringify(v));

const box=document.getElementById("box");
const file=new URLSearchParams(location.search).get("q");
if(!file){box.textContent="file missing";throw"";}

fetch(`all_question_json/${file}`).then(r=>{
  if(!r.ok) throw Error("missing json");
  return r.json();
}).then(q=>{
  const hints=Array.isArray(q.hints)?q.hints:[];
  box.innerHTML=`
    <h2 style="margin:0 0 8px 0">${q.title}</h2>
    <p><span class="badge topic">${q.topic||"â€”"}</span>
       <span class="badge difficulty">${q.difficulty||"â€”"}</span></p>
    <button id="solveBtn">Mark Solved</button>

    <section>${marked.parse(q.stem_md||"")}</section>
    <div class="buttons">
      ${hints.map((_,i)=>`<button onclick="t('h${i}')">Hint ${i+1}</button>`).join("")}
      <button onclick="t('sol')">Solution</button>
    </div>
    ${hints.map((h,i)=>`<div id="h${i}" class="hint">${marked.parse(h)}</div>`).join("")}
    <div id="sol" class="solution">${marked.parse(q.detailed_solution_md||"")}</div>
  `;

  const btn=document.getElementById("solveBtn");
  let solved=LS("solved",[]);
  if(solved.includes(file)) btn.textContent="Unmark Solved";
  btn.onclick=()=>{
    solved=LS("solved",[]);
    if(solved.includes(file)){
      solved=solved.filter(f=>f!==file);
      btn.textContent="Mark Solved";
    }else{
      solved.push(file);
      btn.textContent="Unmark Solved";
    }
    S("solved",solved);
  };

  (function wait(){
    if(typeof renderMathInElement==="function"){
      renderMathInElement(box,{delimiters:[
        {left:"$$",right:"$$",display:true},{left:"$",right:"$",display:false},
        {left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true}
      ],throwOnError:false});
    }else setTimeout(wait,25);
  })();

  box.classList.add("appear");
}).catch(()=>box.textContent="Load error");

function t(id){const e=document.getElementById(id);
  if(e) e.style.display = e.style.display==="block" ? "none" : "block";
}
</script>
</body>
</html>
